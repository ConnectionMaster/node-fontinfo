image:
  - Visual Studio 2017

environment:
  matrix:
    - BuildArch: x64
      Generator: Visual Studio 15 2017 Win64

    - BuildArch: x86
      Generator: Visual Studio 15 2017

  NodeVersion: 8
  BuildDirectory: build
  DistributeDirectory: distribute
  FullDistributePath: $(SLBuildDirectory)\$(SLDistributeDirectory)
  DistributionAritfact: node-fontinfo-$(BuildArch)-$(APPVEYOR_BUILD_VERSION)

install:
  - ps: Install-Product node $env:NodeVersion $env:BuildArch
  - npm install

build_script:
  - cmd: ci\win-build.cmd
  - tar cvaf "%DistributionAritfact%.tar.gz" -C "%FullDistributePath%" "node-fontinfo"

before_deploy:
  - ps: Push-AppveyorArtifact "$env:DistributionAritfact.tar.gz"

deploy:
  - provider: GitHub
    artifact: $(DistributionAritfact).tar.gz
    auth_token:
      secure: nP2TonQxdUNyL65bmBKVPi0/jYX3h6mPCdFgJs1WeD+kNhgoUJ4mqxZ2FWkjpE0N
    draft: false
    prerelease: false
    force_update: true
    on:
      appveyor_repo_tag: true

artifacts:
  - path: $(DistributionAritfact).tar.gz
    name: Distribution Aritfact

test: off